# Тестовое задание

## 1. Вопросы для разогрева

1. Расскажите, с какими задачами в направлении безопасной разработки вы сталкивались?

   На 2-ом курсе обучения в течение года мы изучали основы информационной безопасности. В рамках этого предмета мы работали с
   системой моделирования угроз различных типов, учились их искать и устранять. На последующей учебной практике разрабатывали мобильное приложение
   по стандартам WorldSkills, в котром необходимо было применить полученные знания для обеспечения безопасности сервиса.
   
2. Если вам приходилось проводить security code review или моделирование угроз, расскажите, как это было?

    Как говорилось выше, при обучении использовалась система моделирования угроз. Суть работы была в том, что происходило определенное количество атак
    на различные компоненты сервиса, необходимо было с помощью системы мониторинга найти подозрительные ip-адреса и определить на какие сервера
    были произведены атаки. После чего определяли тип атаки и устраняли дыры в системе.

3. Если у вас был опыт поиска уязвимостей, расскажите, как это было?

    В течение года мы решали различные кейсы в сфере ИБ, в которых рассматривались различные типы уязвимостей и способы их решения. Самым интересным было моделирование нападения злоумышленником и поиск причин проникновения, после чего мы устраняли проблемы.

   Одна из интересных задач была при моделировании нападения. Я искал уязвимость, которая позволила злоумышленнику получить удаленный доступ к системе управления подачи воды.

5. Почему вы хотите участвовать в стажировке?

    Я хотелбы учавствовать в стажировке, поскольку это возможность для меня расширить свои навыки и знания в области ИБ, которая меня всегда интересовала. Я хочу получить практические навыки работы и применить свои навыки на практике. Я считаю, что эта стажировка поможет мне развить свои профессиональные навыки и поможет стать хорошим специалистом

---

## 2. Security code review

### Часть 1. Security code review: GO

Требуется провести анализ кода на GO с точки зрения безопасности и подготовить отчет по следующим пунктам:
 - Какие уязвимости присутствуют в этом фрагменте кода?

   - Открытое соединение с базой данных
   - SQL-инъекция
   - Отсутствие проверки входных данных
   - Отсутствие аунтефикации и авторизации
   - Отсутствие обработчиков ошибок

 - Указать строки, в которых присутствуют уязвимости.

1. Открытое соединение с базой данных  
```
      db, err = sql.Open("mysql", "user:password@/dbname")
```
2. SQL-инъекция
```
      query := fmt.Sprintf("SELECT * FROM products WHERE name LIKE '%%%s%%'", searchQuery)
```

3. Отсутствие проверки входных данных

```
      searchQuery := r.URL.Query().Get("query")
```
4. Отсутствие аунтефикации и авторизации
Отсутствует какая-либо форма авторизации в сервисе,  любой пользователь может получить доступ к обработчику /search
5. Отсутствие обработчиков ошибок
```
      err = db.Ping()
      if err != nil {
          log.Fatal(err)
      }
```
```
      err := rows.Scan(&name)
      if err != nil {
          log.Fatal(err)
      }
```
и др.
 
 - К каким последствиям может привести эксплуатация найденных уязвимостей злоумышленником?
   1. Открытое соединение с базой даных
      В строке подключения к базе явно указан логин и парль. Любой, кто имеет доступ к исходному коду может получить полные данные от базы
   2. SQL-инъекция
       Злоумышленник может вставить SQL-код в параметр query, что позволит ему проводить манпуляции над базой данных. Например, может произойти
       утечка конфедициальных данных пользователей или злоумышленник может удалить полностью базу данных
   3. Отсутствие проверки входных данных
      Нет достаточной валидации и фильтрации ввода от пользователя, что может привести к различным атакам, к примеру XSS
   4. Отсутствие аунтефикации и авторизации
      Обработчик /search доступен всем кто знает его URL-адрес, злоумышленник может выполнить нежелательные запросы
   5. Отсутствие обработчика ошибок
      Ошибки обрабатываются неправильно, что может использоваться злоумышленником для скрытия своей деятельности или проведению атаки на систему. 
 - Описать способы исправления уязвимостей.
   1. Использовать шифрованный файл конфигурации для хранения данных для подлкючения к БД, например в файле JSON или YAML
   2.
    ```
      query := "SELECT * FROM products WHERE name LIKE ?"
      rows, err := db.Query(query, "%"+searchQuery+"%")
    ```
    
   3. Для фильтрации и валидации входных данных от пользователей, можно использовать проверку типов данных, длины строки наличие специальных символов
   4. Создать функцию аунтефикации пользователей
   5. Добавить обработку критических ошибок, в которой будет подробно указыватсья информация о возникших ошибках
 - Если уязвимость можно исправить несколькими способами, необходимо перечислить их, выбрать лучший по вашему мнению и аргументировать свой выбор.

```
package main

import (
    "database/sql"
    "fmt"
    "log"
    "net/http"
    "github.com/go-sql-driver/mysql"
)

var db *sql.DB
var err error

func initDB() {
    db, err = sql.Open("mysql", "user:password@/dbname")
    if err != nil {
        log.Fatal(err)
    }

err = db.Ping()
if err != nil {
    log.Fatal(err)
    }
}

func searchHandler(w http.ResponseWriter, r *http.Request) {
    if r.Method != "GET" {
        http.Error(w, "Method is not supported.", http.StatusNotFound)
        return
    }

searchQuery := r.URL.Query().Get("query")
if searchQuery == "" {
    http.Error(w, "Query parameter is missing", http.StatusBadRequest)
    return
}

query := fmt.Sprintf("SELECT * FROM products WHERE name LIKE '%%%s%%'", searchQuery)
rows, err := db.Query(query)
if err != nil {
    http.Error(w, "Query failed", http.StatusInternalServerError)
    log.Println(err)
    return
}
defer rows.Close()

var products []string
for rows.Next() {
    var name string
    err := rows.Scan(&name)
    if err != nil {
        log.Fatal(err)
    }
    products = append(products, name)
}

fmt.Fprintf(w, "Found products: %v\n", products)
}

func main() {
    initDB()
    defer db.Close()

http.HandleFunc("/search", searchHandler)
fmt.Println("Server is running")
log.Fatal(http.ListenAndServe(":8080", nil))
}
```

### Часть 2: Security code review: Python

Требуется определить тип уязвимости в примерах кода на Python и ответить на следующие вопросы:
 - Указать строки, в которых присутствуют уязвимости.
 - К каким последствиям может привести эксплуатация данных уязвимостей злоумышленником?
 - Описать способы исправления уязвимостей.
 - Если уязвимость можно исправить несколькими способами, необходимо перечислить их, выбрать лучший по вашему мнению и аргументировать свой выбор.

**Пример №2.1**
```
from flask import Flask, request
from jinja2 import Template

app = Flask(name)

@app.route("/page")
def page():
    name = request.values.get('name')
    age = request.values.get('age', 'unknown')
    output = Template('Hello ' + name + '! Your age is ' + age + '.').render()
return output

if name == "main":
    app.run(debug=True)
```
   В строке `name = request.values.get('name')` отсутствует фильтрация ввода, что может привести к XSS атаке, при использовании JavaScript кода
   Можно встроить механизм фильтрации либо использовать функцию escape из модуля murkupsafe, что позволит даже в случае встраивания вредоностного кода отобразить его как текст, а не выполнить как код

   Одна из уязвимостей находится, где происходит форматирование строки. При использовании оператора "+" может произойти инъекция вредоносного кода, которая может позволить выполнить произвольные команды на сервере,
   получить конфидециальные данные или получить доступ к удаленному серверу.
   Исправить можно с помощью f-строки либо метода format. Я бы использовал f-строку, поскольку она более читаемая и удобная при использовании
   ```
   output = Template(f'Hello {name}! Your age is {age}.').render()
   ```
**Пример №2.2**
```
from flask import Flask, request
import subprocess

app = Flask(name)

@app.route("/dns")
def dns_lookup():
    hostname = request.values.get('hostname')
    cmd = 'nslookup ' + hostname
    output = subprocess.check_output(cmd, shell=True, text=True)
return output
if name == "main":
    app.run(debug=True)
```
   первая уязвимость это остутствие аунтефикации и авторизации пользователи при доступе к /dns, что может позволить выполнить dns-запросы на сервере
   Внедрить способы аунтефикации, например использовать стандартные методы аунтефикации Flask'а либо JWT токены

   ```
       cmd = 'nslookup ' + hostname
       output = subprocess.check_output(cmd, shell=True, text=True)
   ```
   В данных строках присутствует уязвимость Command Injection, что может позволить злоумышленникам выполнять произвольные команды на сервере,
   встраивать вредоностное ПО, выполнять вредоносные действия.


   Для устранения уязвимости можно использовать функцию `run` из библиотеки `subprocess` и передать аргументы в виде списка, это позволит избежать выполнение через внешние интерпретаторы
```
cmd = ['nslookup', hostname]
output = subprocess.run(cmd, capture_output=True, text=True).stdout
```
   
## 3. Моделировани угроз

Изучите диаграмму потоков данных (Data Flow Diagram, DFD) сервиса, обеспечивающего отправку информации в Telegram и Slack:

![DFD](https://github.com/appseccloudcamp/test-assignment/blob/main/test-dfd.png)

Краткое описание компонентов сервиса:
 - **User** - авторизованный пользователь системы. Может настраивать отправку уведомлений и загружать изображения для дальнейшего использования при отправке уведомлений;
 - **Microfront** - микрофронт, которые позволяет взаимодействовать с сервисом отправки информации;
 - **Backend application** - набор микросервисов реализующих бизнес-логику приложения и обеспечивающих взаимодействие со всеми внешними сервисами;
 - **Auth** - сервис отвечающий за аутентификацию и авторизацию клиентов сервиса отправки информации;
 - **S3** - объектное хранилище, предназначенное для хранения статического контента сервиса отправки информации;
 - **PostgreSQL** - база данных, предназначенная для хранения пользовательских конфигураций сервиса отправки информации.    

Проанализируйте диаграмму потоков данных приложения и ответьте на следующий вопросы:
 - Расскажите, какие потенциальные проблемы безопасности существуют для данного сервиса?
 - Расскажите, к каким последствиям может привести эксплуатация проблем, найденных вами?
 - Расскажите, какие способы исправления уязвимостей и смягчения рисков вы можете предложить по отмеченным вами проблемам безопасности?
 - Напишите список уточняющих вопросов, которые вы бы задали разработчикам данного сервиса?
